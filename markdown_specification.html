
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Markdown spec &#8212; md-toc 6.0.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contributing" href="contributing.html" />
    <link rel="prev" title="Developer Interface" href="api.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="markdown-spec">
<h1>Markdown spec<a class="headerlink" href="#markdown-spec" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>md_toc aimes to be as conformant as possible to each supported markdown
parser. What follows is a list of parameters and rules used by md_toc to decide
how to parse markdown files and to generate the table of contents.</p>
</div>
<div class="section" id="supported-markdown-parsers">
<h2>Supported markdown parsers<a class="headerlink" href="#supported-markdown-parsers" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">cmark</span></code>:<ul>
<li>“CommonMark parsing and rendering library and program in C”.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">commonmarker</span></code>:<ul>
<li>a “Ruby wrapper for libcmark (CommonMark parser)”.</li>
<li>As described on their website: “It also includes extensions to
the CommonMark spec as documented in the GitHub Flavored Markdown spec,
such as support for tables, strikethroughs, and autolinking.”. For this
reason we assume that <code class="docutils literal notranslate"><span class="pre">commonmarker</span></code> is an alias of <code class="docutils literal notranslate"><span class="pre">github</span></code>.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">github</span></code>:<ul>
<li>uses a forked version of <code class="docutils literal notranslate"><span class="pre">cmark</span></code> with some added extensions
which should not concern md_toc. For this reason we assume that <code class="docutils literal notranslate"><span class="pre">cmark</span></code>
and <code class="docutils literal notranslate"><span class="pre">github</span></code> represent the same parser in md_toc.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">gitlab</span></code>:<ul>
<li>uses <code class="docutils literal notranslate"><span class="pre">commonmarker</span></code>. Older versions of md_toc, prior to
version <code class="docutils literal notranslate"><span class="pre">3.0.0</span></code>, use <code class="docutils literal notranslate"><span class="pre">gitlab</span></code> as an alias of <code class="docutils literal notranslate"><span class="pre">redcarpet</span></code> while
newer versions use <code class="docutils literal notranslate"><span class="pre">github</span></code> instead, because in the past GitLab used
Redcarpet as markdown parser.</li>
<li>The extensions used in GitLab Flavored Markdown (not to be confused
with GitHub Flavored Markdown) should not concern md_toc. For this
reason we assume that <code class="docutils literal notranslate"><span class="pre">gitlab</span></code> is an alias of <code class="docutils literal notranslate"><span class="pre">github</span></code>.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">redcarpet</span></code>:<ul>
<li>“The safe Markdown parser, reloaded.”</li>
</ul>
</li>
</ul>
<div class="section" id="parser-summary">
<h3>Parser Summary<a class="headerlink" href="#parser-summary" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="8%" />
<col width="52%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parser</th>
<th class="head">Alias of</th>
<th class="head">Supported parser version</th>
<th class="head">Source</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cmark</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">github</span></code></td>
<td>&#160;</td>
<td><a class="reference external" href="https://github.com/commonmark/cmark">https://github.com/commonmark/cmark</a></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">commonmarker</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">github</span></code></td>
<td>&#160;</td>
<td><a class="reference external" href="https://github.com/gjtorikian/commonmarker">https://github.com/gjtorikian/commonmarker</a></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">github</span></code></td>
<td>&#160;</td>
<td><code class="docutils literal notranslate"><span class="pre">Version</span> <span class="pre">0.28-gfm</span> <span class="pre">(2017-08-01)</span></code></td>
<td><a class="reference external" href="https://github.com/github/cmark">https://github.com/github/cmark</a></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">gitlab</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">github</span></code></td>
<td>&#160;</td>
<td><a class="reference external" href="https://docs.gitlab.com/ee/user/markdown.html">https://docs.gitlab.com/ee/user/markdown.html</a></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">redcarpet</span></code></td>
<td>&#160;</td>
<td><code class="docutils literal notranslate"><span class="pre">https://github.com/vmg/redcarpet/tree/94f6e27bdf2395efa555a7c772a3d8b70fb84346</span></code></td>
<td><a class="reference external" href="https://github.com/vmg/redcarpet">https://github.com/vmg/redcarpet</a></td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="rules">
<h2>Rules<a class="headerlink" href="#rules" title="Permalink to this headline">¶</a></h2>
<div class="section" id="headers">
<h3>Headers<a class="headerlink" href="#headers" title="Permalink to this headline">¶</a></h3>
<p>Only ATX-style headings are supported in md_toc.</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">github</span></code>: the code used in md_toc is a reverse engineering of the
behavour described in the following:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.github.com/gfm/#atx-heading">https://github.github.com/gfm/#atx-heading</a></li>
</ul>
<p>The escape character <code class="docutils literal notranslate"><span class="pre">\</span></code> will be left as-is since they are parsed by
Github’s markdown parser already:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.github.com/gfm/#backslash-escapes">https://github.github.com/gfm/#backslash-escapes</a></li>
</ul>
<p>A line ending character is <code class="docutils literal notranslate"><span class="pre">U+000A</span></code> or the <code class="docutils literal notranslate"><span class="pre">U+000D</span></code> character,
respectively <code class="docutils literal notranslate"><span class="pre">\n</span></code> and <code class="docutils literal notranslate"><span class="pre">\r</span></code>. Everything following those characters
is ignored. This has also the benefit to automatically remove
the trailing newline or carriage return at the end of each line. This also
includes ARX headers with line endings only as main content, such as
<code class="docutils literal notranslate"><span class="pre">#\n</span></code> or <code class="docutils literal notranslate"><span class="pre">#\r</span></code>. See also:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.github.com/gfm/#line">https://github.github.com/gfm/#line</a></li>
<li><a class="reference external" href="https://github.github.com/gfm/#line-ending">https://github.github.com/gfm/#line-ending</a></li>
</ul>
<p>Every other rule for ATX headings is applied.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">redcarpet</span></code>: this is the license used in md_toc:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">2009</span><span class="p">,</span> <span class="n">Natacha</span> <span class="n">Porté</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">2015</span><span class="p">,</span> <span class="n">Vicent</span> <span class="n">Marti</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">2018</span><span class="p">,</span> <span class="n">Franco</span> <span class="n">Masotti</span> <span class="o">&lt;</span><span class="n">franco</span><span class="o">.</span><span class="n">masotti</span><span class="nd">@student</span><span class="o">.</span><span class="n">unife</span><span class="o">.</span><span class="n">it</span><span class="o">&gt;</span>

<span class="n">Permission</span> <span class="ow">is</span> <span class="n">hereby</span> <span class="n">granted</span><span class="p">,</span> <span class="n">free</span> <span class="n">of</span> <span class="n">charge</span><span class="p">,</span> <span class="n">to</span> <span class="nb">any</span> <span class="n">person</span> <span class="n">obtaining</span> <span class="n">a</span> <span class="n">copy</span>
<span class="n">of</span> <span class="n">this</span> <span class="n">software</span> <span class="ow">and</span> <span class="n">associated</span> <span class="n">documentation</span> <span class="n">files</span> <span class="p">(</span><span class="n">the</span> <span class="s2">&quot;Software&quot;</span><span class="p">),</span> <span class="n">to</span> <span class="n">deal</span>
<span class="ow">in</span> <span class="n">the</span> <span class="n">Software</span> <span class="n">without</span> <span class="n">restriction</span><span class="p">,</span> <span class="n">including</span> <span class="n">without</span> <span class="n">limitation</span> <span class="n">the</span> <span class="n">rights</span>
<span class="n">to</span> <span class="n">use</span><span class="p">,</span> <span class="n">copy</span><span class="p">,</span> <span class="n">modify</span><span class="p">,</span> <span class="n">merge</span><span class="p">,</span> <span class="n">publish</span><span class="p">,</span> <span class="n">distribute</span><span class="p">,</span> <span class="n">sublicense</span><span class="p">,</span> <span class="ow">and</span><span class="o">/</span><span class="ow">or</span> <span class="n">sell</span>
<span class="n">copies</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Software</span><span class="p">,</span> <span class="ow">and</span> <span class="n">to</span> <span class="n">permit</span> <span class="n">persons</span> <span class="n">to</span> <span class="n">whom</span> <span class="n">the</span> <span class="n">Software</span> <span class="ow">is</span>
<span class="n">furnished</span> <span class="n">to</span> <span class="n">do</span> <span class="n">so</span><span class="p">,</span> <span class="n">subject</span> <span class="n">to</span> <span class="n">the</span> <span class="n">following</span> <span class="n">conditions</span><span class="p">:</span>

<span class="n">The</span> <span class="n">above</span> <span class="n">copyright</span> <span class="n">notice</span> <span class="ow">and</span> <span class="n">this</span> <span class="n">permission</span> <span class="n">notice</span> <span class="n">shall</span> <span class="n">be</span> <span class="n">included</span> <span class="ow">in</span>
<span class="nb">all</span> <span class="n">copies</span> <span class="ow">or</span> <span class="n">substantial</span> <span class="n">portions</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Software</span><span class="o">.</span>
<span class="n">THE</span> <span class="n">SOFTWARE</span> <span class="n">IS</span> <span class="n">PROVIDED</span> <span class="s2">&quot;AS IS&quot;</span><span class="p">,</span> <span class="n">WITHOUT</span> <span class="n">WARRANTY</span> <span class="n">OF</span> <span class="n">ANY</span> <span class="n">KIND</span><span class="p">,</span> <span class="n">EXPRESS</span> <span class="n">OR</span>
<span class="n">IMPLIED</span><span class="p">,</span> <span class="n">INCLUDING</span> <span class="n">BUT</span> <span class="n">NOT</span> <span class="n">LIMITED</span> <span class="n">TO</span> <span class="n">THE</span> <span class="n">WARRANTIES</span> <span class="n">OF</span> <span class="n">MERCHANTABILITY</span><span class="p">,</span>
<span class="n">FITNESS</span> <span class="n">FOR</span> <span class="n">A</span> <span class="n">PARTICULAR</span> <span class="n">PURPOSE</span> <span class="n">AND</span> <span class="n">NONINFRINGEMENT</span><span class="o">.</span> <span class="n">IN</span> <span class="n">NO</span> <span class="n">EVENT</span> <span class="n">SHALL</span> <span class="n">THE</span>
<span class="n">AUTHORS</span> <span class="n">OR</span> <span class="n">COPYRIGHT</span> <span class="n">HOLDERS</span> <span class="n">BE</span> <span class="n">LIABLE</span> <span class="n">FOR</span> <span class="n">ANY</span> <span class="n">CLAIM</span><span class="p">,</span> <span class="n">DAMAGES</span> <span class="n">OR</span> <span class="n">OTHER</span>
<span class="n">LIABILITY</span><span class="p">,</span> <span class="n">WHETHER</span> <span class="n">IN</span> <span class="n">AN</span> <span class="n">ACTION</span> <span class="n">OF</span> <span class="n">CONTRACT</span><span class="p">,</span> <span class="n">TORT</span> <span class="n">OR</span> <span class="n">OTHERWISE</span><span class="p">,</span>  <span class="n">ARISING</span> <span class="n">FROM</span><span class="p">,</span>
<span class="n">OUT</span> <span class="n">OF</span> <span class="n">OR</span> <span class="n">IN</span> <span class="n">CONNECTION</span> <span class="n">WITH</span> <span class="n">THE</span> <span class="n">SOFTWARE</span> <span class="n">OR</span> <span class="n">THE</span> <span class="n">USE</span> <span class="n">OR</span> <span class="n">OTHER</span>  <span class="n">DEALINGS</span> <span class="n">IN</span>
<span class="n">THE</span> <span class="n">SOFTWARE</span><span class="o">.</span>
</pre></div>
</div>
<ul class="simple">
<li><a class="reference external" href="https://github.com/vmg/redcarpet/blob/e3a1d0b00a77fa4e2d3c37322bea66b82085486f/ext/redcarpet/markdown.c#L1444">https://github.com/vmg/redcarpet/blob/e3a1d0b00a77fa4e2d3c37322bea66b82085486f/ext/redcarpet/markdown.c#L1444</a></li>
<li><a class="reference external" href="https://github.com/vmg/redcarpet/blob/e3a1d0b00a77fa4e2d3c37322bea66b82085486f/ext/redcarpet/markdown.c#L1981">https://github.com/vmg/redcarpet/blob/e3a1d0b00a77fa4e2d3c37322bea66b82085486f/ext/redcarpet/markdown.c#L1981</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="list-item-rules">
<h3>List item rules<a class="headerlink" href="#list-item-rules" title="Permalink to this headline">¶</a></h3>
<div class="section" id="problems">
<h4>Problems<a class="headerlink" href="#problems" title="Permalink to this headline">¶</a></h4>
<p>We are interested in sublists indentation rules for all types of lists, and
integer overflows in case of ordered lists.</p>
<p>For ordered lists, we are not concerned about using <code class="docutils literal notranslate"><span class="pre">0</span></code> or negative numbers
as list markers so these cases will not be considered. Infact ordred lists
generated by md_toc will always start from <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<p>Talking about indentation rules, I need to mention that the user is responsible
for generating a correct markdown list according to the parser’s rules. Let’s
see this example:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># foo</span>
<span class="c1">## bar</span>
<span class="c1">### baz</span>
</pre></div>
</div>
</div></blockquote>
<p>no problem here because this is rendered by md_toc, using <code class="docutils literal notranslate"><span class="pre">github</span></code> as parser,
with:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="p">[</span><span class="n">foo</span><span class="p">](</span><span class="c1">#foo)</span>
  <span class="o">-</span> <span class="p">[</span><span class="n">bar</span><span class="p">](</span><span class="c1">#bar)</span>
    <span class="o">-</span> <span class="p">[</span><span class="n">baz</span><span class="p">](</span><span class="c1">#baz)</span>
</pre></div>
</div>
</div></blockquote>
<p>Now, let’s take the previous example and reverse the order of the lines:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">### baz</span>
<span class="c1">## bar</span>
<span class="c1"># foo</span>
</pre></div>
</div>
</div></blockquote>
<p>and this is what md_toc renders using <code class="docutils literal notranslate"><span class="pre">github</span></code>:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="p">[</span><span class="n">baz</span><span class="p">](</span><span class="c1">#baz)</span>
<span class="o">-</span> <span class="p">[</span><span class="n">foo</span><span class="p">](</span><span class="c1">#foo)</span>
<span class="o">-</span> <span class="p">[</span><span class="n">bar</span><span class="p">](</span><span class="c1">#bar)</span>
</pre></div>
</div>
</div></blockquote>
<p>while the user might expect this:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="o">-</span> <span class="p">[</span><span class="n">baz</span><span class="p">](</span><span class="c1">#baz)</span>
  <span class="o">-</span> <span class="p">[</span><span class="n">foo</span><span class="p">](</span><span class="c1">#foo)</span>
<span class="o">-</span> <span class="p">[</span><span class="n">bar</span><span class="p">](</span><span class="c1">#bar)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="indentation">
<h4>Indentation<a class="headerlink" href="#indentation" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">github</span></code>: list indentation for sublists with this parser is based on the
previous state, as stated in the GitHub Flavored Markdown document, at
section 5.2:</p>
<blockquote>
<div><p>“The most important thing to notice is that the position of the text after the
list marker determines how much indentation is needed in subsequent blocks in
the list item. If the list marker takes up two spaces, and there are three
spaces between the list marker and the next non-whitespace character, then
blocks must be indented five spaces in order to fall under the list item.”</p>
</div></blockquote>
<ul class="simple">
<li><a class="reference external" href="https://github.github.com/gfm/#list-items">https://github.github.com/gfm/#list-items</a></li>
</ul>
<p>This is also true with the specular case: if our new list element needs less
indentation than the one processed currently, we have to use the same number
of indentation spaces used somewhere earlier in the list.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">redcarpet</span></code>:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/vmg/redcarpet/blob/94f6e27bdf2395efa555a7c772a3d8b70fb84346/ext/redcarpet/markdown.c#L1553">https://github.com/vmg/redcarpet/blob/94f6e27bdf2395efa555a7c772a3d8b70fb84346/ext/redcarpet/markdown.c#L1553</a></li>
<li><a class="reference external" href="https://github.com/vmg/redcarpet/blob/94f6e27bdf2395efa555a7c772a3d8b70fb84346/ext/redcarpet/markdown.c#L1528">https://github.com/vmg/redcarpet/blob/94f6e27bdf2395efa555a7c772a3d8b70fb84346/ext/redcarpet/markdown.c#L1528</a></li>
</ul>
<p>The following C function returns the first non-whitespace character
after the list marker. The value of <code class="docutils literal notranslate"><span class="pre">0</span></code> is returned if the input
line is not a list element. List item rules are explained in the
single line comments.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* prefix_uli • returns unordered list item prefix */</span>
<span class="k">static</span> <span class="kt">size_t</span>
<span class="nf">prefix_uli</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">// There can be up to 3 whitespaces before the list marker.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span><span class="p">)</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span><span class="p">)</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span><span class="p">)</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>

    <span class="c1">// The next non-whitespace character must be a list marker and</span>
    <span class="c1">// the character after the list marker must be a whitespace.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="n">size</span> <span class="o">||</span>
       <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;*&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;+&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="o">||</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39; &#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">// Check that the next line is not a header</span>
    <span class="c1">// that uses the `-` or `=` characters as markers.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_next_headerline</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">// Return the first non whitespace character after the list marker.</span>
    <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As far as I can tell from the previous and other functions, on a new list
block the 4 spaces indentation rule applies:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/vmg/redcarpet/blob/94f6e27bdf2395efa555a7c772a3d8b70fb84346/ext/redcarpet/markdown.c#L1822">https://github.com/vmg/redcarpet/blob/94f6e27bdf2395efa555a7c772a3d8b70fb84346/ext/redcarpet/markdown.c#L1822</a></li>
<li><a class="reference external" href="https://github.com/vmg/redcarpet/blob/94f6e27bdf2395efa555a7c772a3d8b70fb84346/ext/redcarpet/markdown.c#L1873">https://github.com/vmg/redcarpet/blob/94f6e27bdf2395efa555a7c772a3d8b70fb84346/ext/redcarpet/markdown.c#L1873</a></li>
</ul>
<p>This means that anything that has more than 3 whitespaces is considered as
sublist. The only exception seems to be for the first sublist in a list
block, in which that case even a single whitespace counts as a sublist.
The 4 spaces indentation rule appllies nontheless, so to keep things simple
md_toc will always use 4 whitespaces for sublists. Apparently, ordered and
unordered lists share the same proprieties.</p>
<p>Let’s see this example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">I</span>
 <span class="o">-</span> <span class="n">am</span>
     <span class="o">-</span> <span class="n">foo</span>

<span class="n">stop</span>

<span class="o">-</span> <span class="n">I</span>
    <span class="o">-</span> <span class="n">am</span>
        <span class="o">-</span> <span class="n">foo</span>
</pre></div>
</div>
<p>This is how redcarpet renders it once you run <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">redcarpet</span></code>:</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="n">I</span>

<span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="n">am</span>

<span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="n">foo</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">stop</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="n">I</span>

<span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="n">am</span>

<span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="n">foo</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>What follows is an extract of a C function in redcarpet that parses list
items. I have added all the single line comments.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* parse_listitem • parsing of a single list item */</span>
<span class="cm">/*  assuming initial prefix is already removed */</span>
<span class="k">static</span> <span class="kt">size_t</span>
<span class="nf">parse_listitem</span><span class="p">(</span><span class="k">struct</span> <span class="n">buf</span> <span class="o">*</span><span class="n">ob</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sd_markdown</span> <span class="o">*</span><span class="n">rndr</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
<span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">buf</span> <span class="o">*</span><span class="n">work</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">inter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">beg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">pre</span><span class="p">,</span> <span class="n">sublist</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">orgpre</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">in_empty</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_inside_empty</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">in_fence</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">// This is the base case, usually of indentation 0 but it can be</span>
    <span class="c1">// from 0 to 3 spaces. If it was 4 spaces it would be a code</span>
    <span class="c1">// block.</span>
    <span class="cm">/* keeping track of the first indentation prefix */</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">orgpre</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">orgpre</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="n">orgpre</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span><span class="p">)</span>
        <span class="n">orgpre</span><span class="o">++</span><span class="p">;</span>

    <span class="c1">// Get the first index of string after the list marker. Try both</span>
    <span class="c1">// ordered and unordered lists</span>
    <span class="n">beg</span> <span class="o">=</span> <span class="n">prefix_uli</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">beg</span><span class="p">)</span>
        <span class="n">beg</span> <span class="o">=</span> <span class="n">prefix_oli</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">beg</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

    <span class="cm">/* skipping to the beginning of the following line */</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">beg</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">end</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="n">end</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span>
        <span class="n">end</span><span class="o">++</span><span class="p">;</span>

    <span class="c1">// Iterate line by line using the &#39;\n&#39; character as delimiter.</span>
    <span class="cm">/* process the following lines */</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">beg</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">size_t</span> <span class="n">has_next_uli</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">has_next_oli</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="c1">// Go to the next line.</span>
        <span class="n">end</span><span class="o">++</span><span class="p">;</span>

        <span class="c1">// Find the end of the line.</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">end</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="n">end</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span>
            <span class="n">end</span><span class="o">++</span><span class="p">;</span>

        <span class="c1">// Skip the next line if it is empty.</span>
        <span class="cm">/* process an empty line */</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">is_empty</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">beg</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">beg</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">in_empty</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">beg</span> <span class="o">=</span> <span class="n">end</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Count up to 4 characters of indentation.</span>
        <span class="c1">// If we have 4 characters then it might be a sublist.</span>
        <span class="c1">// Note that this is an offset and does not point to an</span>
        <span class="c1">// index in the actual line string.</span>
        <span class="cm">/* calculating the indentation */</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="n">beg</span> <span class="o">+</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">end</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="n">beg</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span><span class="p">)</span>
            <span class="n">i</span><span class="o">++</span><span class="p">;</span>

        <span class="n">pre</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>

        <span class="cm">/* Only check for new list items if we are **not** inside</span>
<span class="cm">         * a fenced code block */</span>
         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">in_fence</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">has_next_uli</span> <span class="o">=</span> <span class="n">prefix_uli</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">beg</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">beg</span> <span class="o">-</span> <span class="n">i</span><span class="p">);</span>
           <span class="n">has_next_oli</span> <span class="o">=</span> <span class="n">prefix_oli</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">beg</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">beg</span> <span class="o">-</span> <span class="n">i</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="cm">/* checking for ul/ol switch */</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">in_empty</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
            <span class="p">((</span><span class="o">*</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MKD_LIST_ORDERED</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">has_next_uli</span><span class="p">)</span> <span class="o">||</span>
            <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MKD_LIST_ORDERED</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">has_next_oli</span><span class="p">))){</span>
            <span class="o">*</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">MKD_LI_END</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span> <span class="cm">/* the following item must have same list type */</span>
        <span class="p">}</span>

        <span class="c1">// Determine if we are dealing with:</span>
        <span class="c1">// - an empty line</span>
        <span class="c1">// - a new list item</span>
        <span class="c1">// - a sublist</span>
        <span class="cm">/* checking for a new item */</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">has_next_uli</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_hrule</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">beg</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">beg</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span> <span class="o">||</span> <span class="n">has_next_oli</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">in_empty</span><span class="p">)</span>
                <span class="n">has_inside_empty</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

            <span class="c1">// The next list item&#39;s indentation (pre) must be the same as</span>
            <span class="c1">// the previous one (orgpre), otherwise it might be a</span>
            <span class="c1">// sublist.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pre</span> <span class="o">==</span> <span class="n">orgpre</span><span class="p">)</span> <span class="cm">/* the following item must have */</span>
                <span class="k">break</span><span class="p">;</span>             <span class="cm">/* the same indentation */</span>

            <span class="c1">// If the indentation does not match the previous one then</span>
            <span class="c1">// assume that it is a sublist. Check later whether it is</span>
            <span class="c1">// or not.</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sublist</span><span class="p">)</span>
                <span class="n">sublist</span> <span class="o">=</span> <span class="n">work</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="cm">/* joining only indented stuff after empty lines */</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">in_empty</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="n">beg</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;\t&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">*</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">MKD_LI_END</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">in_empty</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Add a line delimiter to the next line if it is missing.</span>
            <span class="n">bufputc</span><span class="p">(</span><span class="n">work</span><span class="p">,</span> <span class="sc">&#39;\n&#39;</span><span class="p">);</span>
            <span class="n">has_inside_empty</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">in_empty</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">beg</span> <span class="o">=</span> <span class="n">end</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MKD_LI_BLOCK</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/* intermediate render of block li */</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sublist</span> <span class="o">&amp;&amp;</span> <span class="n">sublist</span> <span class="o">&lt;</span> <span class="n">work</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">parse_block</span><span class="p">(</span><span class="n">inter</span><span class="p">,</span> <span class="n">rndr</span><span class="p">,</span> <span class="n">work</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="n">sublist</span><span class="p">);</span>
            <span class="n">parse_block</span><span class="p">(</span><span class="n">inter</span><span class="p">,</span> <span class="n">rndr</span><span class="p">,</span> <span class="n">work</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">+</span> <span class="n">sublist</span><span class="p">,</span> <span class="n">work</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">-</span> <span class="n">sublist</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">parse_block</span><span class="p">(</span><span class="n">inter</span><span class="p">,</span> <span class="n">rndr</span><span class="p">,</span> <span class="n">work</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="n">work</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>According to the code, <code class="docutils literal notranslate"><span class="pre">parse_listitem</span></code> is called indirectly by
<code class="docutils literal notranslate"><span class="pre">parse_block</span></code> (via <code class="docutils literal notranslate"><span class="pre">parse_list</span></code>), but <code class="docutils literal notranslate"><span class="pre">parse_block</span></code> is called directly
by <code class="docutils literal notranslate"><span class="pre">parse_listitem</span></code> so the code analysis
is not trivial. For this reason I might be mistaken about the 4 spaces
indentation rule.</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/vmg/redcarpet/blob/94f6e27bdf2395efa555a7c772a3d8b70fb84346/ext/redcarpet/markdown.c#L2418">https://github.com/vmg/redcarpet/blob/94f6e27bdf2395efa555a7c772a3d8b70fb84346/ext/redcarpet/markdown.c#L2418</a></li>
<li><a class="reference external" href="https://github.com/vmg/redcarpet/blob/94f6e27bdf2395efa555a7c772a3d8b70fb84346/ext/redcarpet/markdown.c#L1958">https://github.com/vmg/redcarpet/blob/94f6e27bdf2395efa555a7c772a3d8b70fb84346/ext/redcarpet/markdown.c#L1958</a></li>
</ul>
<p>Here is an extract of the <code class="docutils literal notranslate"><span class="pre">parse_block</span></code> function with the calls to
<code class="docutils literal notranslate"><span class="pre">parse_list</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* parse_block • parsing of one block, returning next uint8_t to parse */</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">parse_block</span><span class="p">(</span><span class="k">struct</span> <span class="n">buf</span> <span class="o">*</span><span class="n">ob</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sd_markdown</span> <span class="o">*</span><span class="n">rndr</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">size_t</span>
<span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">beg</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">prefix_uli</span><span class="p">(</span><span class="n">txt_data</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
          <span class="n">beg</span> <span class="o">+=</span> <span class="n">parse_list</span><span class="p">(</span><span class="n">ob</span><span class="p">,</span> <span class="n">rndr</span><span class="p">,</span> <span class="n">txt_data</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">prefix_oli</span><span class="p">(</span><span class="n">txt_data</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
          <span class="n">beg</span> <span class="o">+=</span> <span class="n">parse_list</span><span class="p">(</span><span class="n">ob</span><span class="p">,</span> <span class="n">rndr</span><span class="p">,</span> <span class="n">txt_data</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">MKD_LIST_ORDERED</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="overflows">
<h4>Overflows<a class="headerlink" href="#overflows" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">github</span></code>: ordered list markers cannot exceed <code class="docutils literal notranslate"><span class="pre">99999999</span></code> according to
the following. If that is the case then a  <code class="docutils literal notranslate"><span class="pre">GithubOverflowOrderedListMarker</span></code>
exception is raised:<ul>
<li><a class="reference external" href="https://github.github.com/gfm/#ordered-list-marker">https://github.github.com/gfm/#ordered-list-marker</a></li>
<li><a class="reference external" href="https://spec.commonmark.org/0.28/#ordered-list-marker">https://spec.commonmark.org/0.28/#ordered-list-marker</a></li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">redcarpet</span></code>: apparently there are no cases of ordered list marker
overflows:<ul>
<li><a class="reference external" href="https://github.com/vmg/redcarpet/blob/8db31cb83e7d81b19970466645e899b5ac3bc15d/ext/redcarpet/markdown.c#L1529">https://github.com/vmg/redcarpet/blob/8db31cb83e7d81b19970466645e899b5ac3bc15d/ext/redcarpet/markdown.c#L1529</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="link-label">
<h3>Link label<a class="headerlink" href="#link-label" title="Permalink to this headline">¶</a></h3>
<p>If the user decides to generate the table of contents with the anchor links,
then link label rules will be applied.</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">github</span></code>:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.github.com/gfm/#link-label">https://github.github.com/gfm/#link-label</a></li>
</ul>
<p>If a line ends in 1 or more ‘’ characters, this disrupts the anchor
title. For example <code class="docutils literal notranslate"><span class="pre">-</span> <span class="pre">[xdmdmsdm\](#xdmdmsdm)</span></code> becomes
<code class="docutils literal notranslate"><span class="pre">&lt;ul&gt;&lt;li&gt;[xdmdmsdm](#xdmdmsdm)&lt;/li&gt;&lt;/ul&gt;</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">&lt;ul&gt;&lt;li&gt;&lt;a</span> <span class="pre">href=&quot;xdmdmsdm&quot;&gt;xdmdmsdm\&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;</span></code>.
The workaround used in md_toc is to add a space character at the end of the
string, so it becomes: <code class="docutils literal notranslate"><span class="pre">&lt;ul&gt;&lt;li&gt;&lt;a</span> <span class="pre">href=&quot;xdmdmsdm&quot;&gt;xdmdmsdm\</span> <span class="pre">&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;</span></code></p>
<p>If the link label contains only whitespace characters a <code class="docutils literal notranslate"><span class="pre">GithubEmptyLinkLabel</span></code>
exception is raised.</p>
<p>If the number of characters inside the link label is over 999 a
<code class="docutils literal notranslate"><span class="pre">GithubOverflowCharsLinkLabel</span></code> is raised.</p>
<p>If the headers contains <code class="docutils literal notranslate"><span class="pre">[</span></code> or <code class="docutils literal notranslate"><span class="pre">]</span></code>, these characters
are treated with the following rules.</p>
<ul class="simple">
<li><a class="reference external" href="https://github.github.com/gfm/#link-text">https://github.github.com/gfm/#link-text</a></li>
<li><a class="reference external" href="https://github.github.com/gfm/#example-302">https://github.github.com/gfm/#example-302</a></li>
<li><a class="reference external" href="https://github.github.com/gfm/#example-496">https://github.github.com/gfm/#example-496</a></li>
</ul>
<p>According to a function in the source code, balanced square brackets do not
work, however they do when interpeted by the web interface. It is however
possible that they are supported within the <code class="docutils literal notranslate"><span class="pre">handle_close_bracket</span></code>
function.</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/github/cmark/blob/6b101e33ba1637e294076c46c69cd6a262c7539f/src/inlines.c#L881">https://github.com/github/cmark/blob/6b101e33ba1637e294076c46c69cd6a262c7539f/src/inlines.c#L881</a></li>
<li><a class="reference external" href="https://github.com/github/cmark/blob/6b101e33ba1637e294076c46c69cd6a262c7539f/src/inlines.c#L994">https://github.com/github/cmark/blob/6b101e33ba1637e294076c46c69cd6a262c7539f/src/inlines.c#L994</a></li>
</ul>
<p>Here is the original C function with some more comments added:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Parse a link label.  Returns 1 if successful.</span>
<span class="c1">// Note:  unescaped brackets are not allowed in labels.</span>
<span class="c1">// The label begins with `[` and ends with the first `]` character</span>
<span class="c1">// encountered.  Backticks in labels do not start code spans.</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">link_label</span><span class="p">(</span><span class="n">subject</span> <span class="o">*</span><span class="n">subj</span><span class="p">,</span> <span class="n">cmark_chunk</span> <span class="o">*</span><span class="n">raw_label</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">bufsize_t</span> <span class="n">startpos</span> <span class="o">=</span> <span class="n">subj</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>

  <span class="c1">// advance past [</span>
  <span class="c1">//</span>
  <span class="c1">// Ignore the open link label identifier</span>
  <span class="c1">// peek_char simply returns the current char if we are</span>
  <span class="c1">// in range of the string, 0 otherwise.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">peek_char</span><span class="p">(</span><span class="n">subj</span><span class="p">)</span> <span class="o">==</span> <span class="sc">&#39;[&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">advance</span><span class="p">(</span><span class="n">subj</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">while</span> <span class="p">((</span><span class="n">c</span> <span class="o">=</span> <span class="n">peek_char</span><span class="p">(</span><span class="n">subj</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">!=</span> <span class="sc">&#39;[&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">!=</span> <span class="sc">&#39;]&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// If there is an escape and the next character is (for example)</span>
    <span class="c1">// &#39;[&#39; or &#39;]&#39; then,</span>
    <span class="c1">// ignore the loop conditions.</span>
    <span class="c1">// If there are nested balanced square brakets this loop ends.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\\&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">advance</span><span class="p">(</span><span class="n">subj</span><span class="p">);</span>
      <span class="n">length</span><span class="o">++</span><span class="p">;</span>

      <span class="c1">// Puntuation characters are the ones defined at:</span>
      <span class="c1">// https://github.github.com/gfm/#ascii-punctuation-character</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cmark_ispunct</span><span class="p">(</span><span class="n">peek_char</span><span class="p">(</span><span class="n">subj</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">advance</span><span class="p">(</span><span class="n">subj</span><span class="p">);</span>
        <span class="n">length</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">advance</span><span class="p">(</span><span class="n">subj</span><span class="p">);</span>
      <span class="n">length</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// MAX_LINK_LABEL_LENGTH is a constant defined at</span>
    <span class="c1">// https://github.com/github/cmark/blob/master/src/parser.h#L13</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="o">&gt;</span> <span class="n">MAX_LINK_LABEL_LENGTH</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">goto</span> <span class="n">noMatch</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// If the loop terminates when the current character is &#39;]&#39; then</span>
  <span class="c1">// everything between &#39;[&#39; and &#39;]&#39; is the link label...</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;]&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// match found</span>
    <span class="o">*</span><span class="n">raw_label</span> <span class="o">=</span>
        <span class="n">cmark_chunk_dup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">subj</span><span class="o">-&gt;</span><span class="n">input</span><span class="p">,</span> <span class="n">startpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">subj</span><span class="o">-&gt;</span><span class="n">pos</span> <span class="o">-</span> <span class="p">(</span><span class="n">startpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
    <span class="n">cmark_chunk_trim</span><span class="p">(</span><span class="n">raw_label</span><span class="p">);</span>
    <span class="n">advance</span><span class="p">(</span><span class="n">subj</span><span class="p">);</span> <span class="c1">// advance past ]</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

<span class="c1">// ...otherwise return error.</span>
<span class="c1">// This label always get executed according to C rules.</span>
<span class="nl">noMatch</span><span class="p">:</span>
  <span class="n">subj</span><span class="o">-&gt;</span><span class="n">pos</span> <span class="o">=</span> <span class="n">startpos</span><span class="p">;</span> <span class="c1">// rewind</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For simpleness the escape <code class="docutils literal notranslate"><span class="pre">[</span></code> and <code class="docutils literal notranslate"><span class="pre">]</span></code> rule is used.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">redcarpet</span></code>:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/vmg/redcarpet/blob/e3a1d0b00a77fa4e2d3c37322bea66b82085486f/ext/redcarpet/markdown.c#L998">https://github.com/vmg/redcarpet/blob/e3a1d0b00a77fa4e2d3c37322bea66b82085486f/ext/redcarpet/markdown.c#L998</a></li>
</ul>
<p>Let’s inspect this loop:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/vmg/redcarpet/blob/e3a1d0b00a77fa4e2d3c37322bea66b82085486f/ext/redcarpet/markdown.c#L1017">https://github.com/vmg/redcarpet/blob/e3a1d0b00a77fa4e2d3c37322bea66b82085486f/ext/redcarpet/markdown.c#L1017</a>):</li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* looking for the matching closing bracket */</span>
<span class="k">for</span> <span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span>
        <span class="n">text_has_nl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;\\&#39;</span><span class="p">)</span>
        <span class="k">continue</span><span class="p">;</span>

    <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;[&#39;</span><span class="p">)</span>
        <span class="n">level</span><span class="o">++</span><span class="p">;</span>

    <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;]&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">level</span><span class="o">--</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">level</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">)</span>
    <span class="k">goto</span> <span class="n">cleanup</span><span class="p">;</span>
</pre></div>
</div>
<p>The cleanup label looks like this:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* cleanup */</span>
<span class="nl">cleanup</span><span class="p">:</span>
    <span class="n">rndr</span><span class="o">-&gt;</span><span class="n">work_bufs</span><span class="p">[</span><span class="n">BUFFER_SPAN</span><span class="p">].</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">org_work_size</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">ret</span> <span class="o">?</span> <span class="nl">i</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>An example: <code class="docutils literal notranslate"><span class="pre">[test</span> <span class="pre">\](test</span> <span class="pre">\)</span></code> becomes <code class="docutils literal notranslate"><span class="pre">[test</span> <span class="pre">](test</span> <span class="pre">)</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">href=&quot;test</span> <span class="pre">\&quot;&gt;test</span> <span class="pre">\&lt;/a&gt;</span></code></p>
<p>Infact, you can see that if the current character is <code class="docutils literal notranslate"><span class="pre">\\</span></code> then the the
current iteration is skipped. If for any chance the next character is <code class="docutils literal notranslate"><span class="pre">]</span></code>
then the inline link closing parenthesis detection is ignored. <code class="docutils literal notranslate"><span class="pre">i</span></code> becomes
equal to <code class="docutils literal notranslate"><span class="pre">size</span></code> eventually and so we jump to the <code class="docutils literal notranslate"><span class="pre">cleanup</span></code> label.
That lable contains a return statement so that string is not treated as
inline link anymore. A similar code is implemented also for
detecting <code class="docutils literal notranslate"><span class="pre">(</span></code> and <code class="docutils literal notranslate"><span class="pre">)</span></code>. See:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/vmg/redcarpet/blob/e3a1d0b00a77fa4e2d3c37322bea66b82085486f/ext/redcarpet/markdown.c#L1088">https://github.com/vmg/redcarpet/blob/e3a1d0b00a77fa4e2d3c37322bea66b82085486f/ext/redcarpet/markdown.c#L1088</a></li>
<li><a class="reference external" href="https://github.com/vmg/redcarpet/blob/e3a1d0b00a77fa4e2d3c37322bea66b82085486f/ext/redcarpet/markdown.c#L1099">https://github.com/vmg/redcarpet/blob/e3a1d0b00a77fa4e2d3c37322bea66b82085486f/ext/redcarpet/markdown.c#L1099</a></li>
</ul>
<p>To solve this we use the same workaround used for <code class="docutils literal notranslate"><span class="pre">github</span></code>.</p>
</li>
</ul>
</div>
<div class="section" id="anchor-link-types-and-behaviours">
<h3>Anchor link types and behaviours<a class="headerlink" href="#anchor-link-types-and-behaviours" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">github</span></code>: a translated version of the Ruby algorithm is used in md_toc.
The original one is repored here:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/jch/html-pipeline/blob/master/lib/html/pipeline/toc_filter.rb">https://github.com/jch/html-pipeline/blob/master/lib/html/pipeline/toc_filter.rb</a></li>
</ul>
<p>I could not find the code directly responsable for the anchor link generation.
See also:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.github.com/gfm/">https://github.github.com/gfm/</a></li>
<li><a class="reference external" href="https://githubengineering.com/a-formal-spec-for-github-markdown/">https://githubengineering.com/a-formal-spec-for-github-markdown/</a></li>
<li><a class="reference external" href="https://github.com/github/cmark/issues/65#issuecomment-343433978">https://github.com/github/cmark/issues/65#issuecomment-343433978</a></li>
</ul>
<p>This is the license used in md_toc:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">2012</span> <span class="n">GitHub</span> <span class="n">Inc</span><span class="o">.</span> <span class="ow">and</span> <span class="n">Jerry</span> <span class="n">Cheung</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">2018</span><span class="p">,</span> <span class="n">Franco</span> <span class="n">Masotti</span> <span class="o">&lt;</span><span class="n">franco</span><span class="o">.</span><span class="n">masotti</span><span class="nd">@student</span><span class="o">.</span><span class="n">unife</span><span class="o">.</span><span class="n">it</span><span class="o">&gt;</span>

<span class="n">MIT</span> <span class="n">License</span>

<span class="n">Permission</span> <span class="ow">is</span> <span class="n">hereby</span> <span class="n">granted</span><span class="p">,</span> <span class="n">free</span> <span class="n">of</span> <span class="n">charge</span><span class="p">,</span> <span class="n">to</span> <span class="nb">any</span> <span class="n">person</span> <span class="n">obtaining</span>
<span class="n">a</span> <span class="n">copy</span> <span class="n">of</span> <span class="n">this</span> <span class="n">software</span> <span class="ow">and</span> <span class="n">associated</span> <span class="n">documentation</span> <span class="n">files</span> <span class="p">(</span><span class="n">the</span>
<span class="s2">&quot;Software&quot;</span><span class="p">),</span> <span class="n">to</span> <span class="n">deal</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">Software</span> <span class="n">without</span> <span class="n">restriction</span><span class="p">,</span> <span class="n">including</span>
<span class="n">without</span> <span class="n">limitation</span> <span class="n">the</span> <span class="n">rights</span> <span class="n">to</span> <span class="n">use</span><span class="p">,</span> <span class="n">copy</span><span class="p">,</span> <span class="n">modify</span><span class="p">,</span> <span class="n">merge</span><span class="p">,</span> <span class="n">publish</span><span class="p">,</span>
<span class="n">distribute</span><span class="p">,</span> <span class="n">sublicense</span><span class="p">,</span> <span class="ow">and</span><span class="o">/</span><span class="ow">or</span> <span class="n">sell</span> <span class="n">copies</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Software</span><span class="p">,</span> <span class="ow">and</span> <span class="n">to</span>
<span class="n">permit</span> <span class="n">persons</span> <span class="n">to</span> <span class="n">whom</span> <span class="n">the</span> <span class="n">Software</span> <span class="ow">is</span> <span class="n">furnished</span> <span class="n">to</span> <span class="n">do</span> <span class="n">so</span><span class="p">,</span> <span class="n">subject</span> <span class="n">to</span>
<span class="n">the</span> <span class="n">following</span> <span class="n">conditions</span><span class="p">:</span>

<span class="n">The</span> <span class="n">above</span> <span class="n">copyright</span> <span class="n">notice</span> <span class="ow">and</span> <span class="n">this</span> <span class="n">permission</span> <span class="n">notice</span> <span class="n">shall</span> <span class="n">be</span>
<span class="n">included</span> <span class="ow">in</span> <span class="nb">all</span> <span class="n">copies</span> <span class="ow">or</span> <span class="n">substantial</span> <span class="n">portions</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Software</span><span class="o">.</span>

<span class="n">THE</span> <span class="n">SOFTWARE</span> <span class="n">IS</span> <span class="n">PROVIDED</span> <span class="s2">&quot;AS IS&quot;</span><span class="p">,</span> <span class="n">WITHOUT</span> <span class="n">WARRANTY</span> <span class="n">OF</span> <span class="n">ANY</span> <span class="n">KIND</span><span class="p">,</span>
<span class="n">EXPRESS</span> <span class="n">OR</span> <span class="n">IMPLIED</span><span class="p">,</span> <span class="n">INCLUDING</span> <span class="n">BUT</span> <span class="n">NOT</span> <span class="n">LIMITED</span> <span class="n">TO</span> <span class="n">THE</span> <span class="n">WARRANTIES</span> <span class="n">OF</span>
<span class="n">MERCHANTABILITY</span><span class="p">,</span> <span class="n">FITNESS</span> <span class="n">FOR</span> <span class="n">A</span> <span class="n">PARTICULAR</span> <span class="n">PURPOSE</span> <span class="n">AND</span>
<span class="n">NONINFRINGEMENT</span><span class="o">.</span> <span class="n">IN</span> <span class="n">NO</span> <span class="n">EVENT</span> <span class="n">SHALL</span> <span class="n">THE</span> <span class="n">AUTHORS</span> <span class="n">OR</span> <span class="n">COPYRIGHT</span> <span class="n">HOLDERS</span> <span class="n">BE</span>
<span class="n">LIABLE</span> <span class="n">FOR</span> <span class="n">ANY</span> <span class="n">CLAIM</span><span class="p">,</span> <span class="n">DAMAGES</span> <span class="n">OR</span> <span class="n">OTHER</span> <span class="n">LIABILITY</span><span class="p">,</span> <span class="n">WHETHER</span> <span class="n">IN</span> <span class="n">AN</span> <span class="n">ACTION</span>
<span class="n">OF</span> <span class="n">CONTRACT</span><span class="p">,</span> <span class="n">TORT</span> <span class="n">OR</span> <span class="n">OTHERWISE</span><span class="p">,</span> <span class="n">ARISING</span> <span class="n">FROM</span><span class="p">,</span> <span class="n">OUT</span> <span class="n">OF</span> <span class="n">OR</span> <span class="n">IN</span> <span class="n">CONNECTION</span>
<span class="n">WITH</span> <span class="n">THE</span> <span class="n">SOFTWARE</span> <span class="n">OR</span> <span class="n">THE</span> <span class="n">USE</span> <span class="n">OR</span> <span class="n">OTHER</span> <span class="n">DEALINGS</span> <span class="n">IN</span> <span class="n">THE</span> <span class="n">SOFTWARE</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">redcarpet</span></code>: treats consecutive dash characters by tranforming them
into a single dash character. A translated version of the C algorithm
is used in md_toc. The original version is here:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/vmg/redcarpet/blob/26c80f05e774b31cd01255b0fa62e883ac185bf3/ext/redcarpet/html.c#L274">https://github.com/vmg/redcarpet/blob/26c80f05e774b31cd01255b0fa62e883ac185bf3/ext/redcarpet/html.c#L274</a></li>
</ul>
<p>This is the license used in md_toc:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">2009</span><span class="p">,</span> <span class="n">Natacha</span> <span class="n">Porté</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">2015</span><span class="p">,</span> <span class="n">Vicent</span> <span class="n">Marti</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">2018</span><span class="p">,</span> <span class="n">Franco</span> <span class="n">Masotti</span> <span class="o">&lt;</span><span class="n">franco</span><span class="o">.</span><span class="n">masotti</span><span class="nd">@student</span><span class="o">.</span><span class="n">unife</span><span class="o">.</span><span class="n">it</span><span class="o">&gt;</span>

<span class="n">Permission</span> <span class="ow">is</span> <span class="n">hereby</span> <span class="n">granted</span><span class="p">,</span> <span class="n">free</span> <span class="n">of</span> <span class="n">charge</span><span class="p">,</span> <span class="n">to</span> <span class="nb">any</span> <span class="n">person</span> <span class="n">obtaining</span> <span class="n">a</span> <span class="n">copy</span>
<span class="n">of</span> <span class="n">this</span> <span class="n">software</span> <span class="ow">and</span> <span class="n">associated</span> <span class="n">documentation</span> <span class="n">files</span> <span class="p">(</span><span class="n">the</span> <span class="s2">&quot;Software&quot;</span><span class="p">),</span> <span class="n">to</span> <span class="n">deal</span>
<span class="ow">in</span> <span class="n">the</span> <span class="n">Software</span> <span class="n">without</span> <span class="n">restriction</span><span class="p">,</span> <span class="n">including</span> <span class="n">without</span> <span class="n">limitation</span> <span class="n">the</span> <span class="n">rights</span>
<span class="n">to</span> <span class="n">use</span><span class="p">,</span> <span class="n">copy</span><span class="p">,</span> <span class="n">modify</span><span class="p">,</span> <span class="n">merge</span><span class="p">,</span> <span class="n">publish</span><span class="p">,</span> <span class="n">distribute</span><span class="p">,</span> <span class="n">sublicense</span><span class="p">,</span> <span class="ow">and</span><span class="o">/</span><span class="ow">or</span> <span class="n">sell</span>
<span class="n">copies</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Software</span><span class="p">,</span> <span class="ow">and</span> <span class="n">to</span> <span class="n">permit</span> <span class="n">persons</span> <span class="n">to</span> <span class="n">whom</span> <span class="n">the</span> <span class="n">Software</span> <span class="ow">is</span>
<span class="n">furnished</span> <span class="n">to</span> <span class="n">do</span> <span class="n">so</span><span class="p">,</span> <span class="n">subject</span> <span class="n">to</span> <span class="n">the</span> <span class="n">following</span> <span class="n">conditions</span><span class="p">:</span>

<span class="n">The</span> <span class="n">above</span> <span class="n">copyright</span> <span class="n">notice</span> <span class="ow">and</span> <span class="n">this</span> <span class="n">permission</span> <span class="n">notice</span> <span class="n">shall</span> <span class="n">be</span> <span class="n">included</span> <span class="ow">in</span>
<span class="nb">all</span> <span class="n">copies</span> <span class="ow">or</span> <span class="n">substantial</span> <span class="n">portions</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Software</span><span class="o">.</span>
<span class="n">THE</span> <span class="n">SOFTWARE</span> <span class="n">IS</span> <span class="n">PROVIDED</span> <span class="s2">&quot;AS IS&quot;</span><span class="p">,</span> <span class="n">WITHOUT</span> <span class="n">WARRANTY</span> <span class="n">OF</span> <span class="n">ANY</span> <span class="n">KIND</span><span class="p">,</span> <span class="n">EXPRESS</span> <span class="n">OR</span>
<span class="n">IMPLIED</span><span class="p">,</span> <span class="n">INCLUDING</span> <span class="n">BUT</span> <span class="n">NOT</span> <span class="n">LIMITED</span> <span class="n">TO</span> <span class="n">THE</span> <span class="n">WARRANTIES</span> <span class="n">OF</span> <span class="n">MERCHANTABILITY</span><span class="p">,</span>
<span class="n">FITNESS</span> <span class="n">FOR</span> <span class="n">A</span> <span class="n">PARTICULAR</span> <span class="n">PURPOSE</span> <span class="n">AND</span> <span class="n">NONINFRINGEMENT</span><span class="o">.</span> <span class="n">IN</span> <span class="n">NO</span> <span class="n">EVENT</span> <span class="n">SHALL</span> <span class="n">THE</span>
<span class="n">AUTHORS</span> <span class="n">OR</span> <span class="n">COPYRIGHT</span> <span class="n">HOLDERS</span> <span class="n">BE</span> <span class="n">LIABLE</span> <span class="n">FOR</span> <span class="n">ANY</span> <span class="n">CLAIM</span><span class="p">,</span> <span class="n">DAMAGES</span> <span class="n">OR</span> <span class="n">OTHER</span>
<span class="n">LIABILITY</span><span class="p">,</span> <span class="n">WHETHER</span> <span class="n">IN</span> <span class="n">AN</span> <span class="n">ACTION</span> <span class="n">OF</span> <span class="n">CONTRACT</span><span class="p">,</span> <span class="n">TORT</span> <span class="n">OR</span> <span class="n">OTHERWISE</span><span class="p">,</span>  <span class="n">ARISING</span> <span class="n">FROM</span><span class="p">,</span>
<span class="n">OUT</span> <span class="n">OF</span> <span class="n">OR</span> <span class="n">IN</span> <span class="n">CONNECTION</span> <span class="n">WITH</span> <span class="n">THE</span> <span class="n">SOFTWARE</span> <span class="n">OR</span> <span class="n">THE</span> <span class="n">USE</span> <span class="n">OR</span> <span class="n">OTHER</span>  <span class="n">DEALINGS</span> <span class="n">IN</span>
<span class="n">THE</span> <span class="n">SOFTWARE</span><span class="o">.</span>
</pre></div>
</div>
<p>See also:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/vmg/redcarpet/issues/618#issuecomment-306476184">https://github.com/vmg/redcarpet/issues/618#issuecomment-306476184</a></li>
<li><a class="reference external" href="https://github.com/vmg/redcarpet/issues/307#issuecomment-261793668">https://github.com/vmg/redcarpet/issues/307#issuecomment-261793668</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="code-fence">
<h3>Code fence<a class="headerlink" href="#code-fence" title="Permalink to this headline">¶</a></h3>
<p>Code fences are sections of a markdown document where some parsers treat the
text within them as verbatim. Usually the purpose of these sections is to
display source code. Some programming languages use the character <code class="docutils literal notranslate"><span class="pre">#</span></code> as a
way to comment a line in the code. For this reason md_toc needs to ignore code
fences in order not to treat the <code class="docutils literal notranslate"><span class="pre">#</span></code> character as an ATX-style heading and thus
get parsed as an element of the TOC.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">github</span></code>: the rules followed are the ones reported on the
documentation:<ul>
<li><a class="reference external" href="https://github.github.com/gfm/#code-fence">https://github.github.com/gfm/#code-fence</a></li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">redcarpet</span></code>: needs to be implemented:<ul>
<li><a class="reference external" href="https://github.com/vmg/redcarpet/blob/26c80f05e774b31cd01255b0fa62e883ac185bf3/ext/redcarpet/markdown.c#L1389">https://github.com/vmg/redcarpet/blob/26c80f05e774b31cd01255b0fa62e883ac185bf3/ext/redcarpet/markdown.c#L1389</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="toc-marker">
<h3>TOC marker<a class="headerlink" href="#toc-marker" title="Permalink to this headline">¶</a></h3>
<p>A TOC marker is a string that marks that the start and the end of the table
of contents in a markdown file.</p>
<p>By default it was decided to use <code class="docutils literal notranslate"><span class="pre">[](TOC)</span></code> as the default TOC marker because
it would result invisible in some markdown parsers. In other cases, however, such
as the one used by Gitea, that particular TOC marker was still visible. HTML
comments seem to be a better solution.</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">github</span></code>:</p>
<ul class="simple">
<li><a class="reference external" href="https://spec.commonmark.org/0.28/#html-comment">https://spec.commonmark.org/0.28/#html-comment</a></li>
</ul>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">redcarpet</span></code>:</p>
<p>I cannot find the corresponding code, but I found this:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/vmg/redcarpet/blob/master/test/MarkdownTest_1.0.3/Tests/Inline%20HTML%20comments.html">https://github.com/vmg/redcarpet/blob/master/test/MarkdownTest_1.0.3/Tests/Inline%20HTML%20comments.html</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="other-markdown-parsers">
<h2>Other markdown parsers<a class="headerlink" href="#other-markdown-parsers" title="Permalink to this headline">¶</a></h2>
<p>If you have a look at
<a class="reference external" href="https://www.w3.org/community/markdown/wiki/MarkdownImplementations">https://www.w3.org/community/markdown/wiki/MarkdownImplementations</a>
you will see that there are a ton of different markdown parsers out there.
Moreover, that list has not been updated in a while.</p>
<p>Markdown parsers have different behaviours regarding anchor links. Some of them
implement them while others don’t; some act on the duplicate entry problem
while others don’t; some strip consecutive dash characters while others don’t.
And it’s not just about anchor links, as you have read before. For example:</p>
<ul>
<li><p class="first">Gogs, Marked, Notabug, Gitea: Gogs uses marked as the markdown
parser while <em>NotABug.org is powered by a liberated version of gogs</em>.
Gitea, a fork of Gogs, probably uses a custom parser. See link below.
Situation is unclear. Here are some links:</p>
<ul class="simple">
<li><a class="reference external" href="https://gogs.io/docs">https://gogs.io/docs</a></li>
<li><a class="reference external" href="https://github.com/chjj/marked">https://github.com/chjj/marked</a></li>
<li><a class="reference external" href="https://github.com/chjj/marked/issues/981">https://github.com/chjj/marked/issues/981</a></li>
<li><a class="reference external" href="https://github.com/chjj/marked/search?q=anchor&amp;type=Issues&amp;utf8=%E2%9C%93">https://github.com/chjj/marked/search?q=anchor&amp;type=Issues&amp;utf8=%E2%9C%93</a></li>
<li><a class="reference external" href="https://notabug.org/hp/gogs/">https://notabug.org/hp/gogs/</a></li>
<li><a class="reference external" href="https://github.com/go-gitea/gitea">https://github.com/go-gitea/gitea</a></li>
<li><a class="reference external" href="https://github.com/go-gitea/gitea/blob/2a03e96bceadfcc5e18bd61e755980ee72dcdb15/modules/markup/markdown/markdown.go">https://github.com/go-gitea/gitea/blob/2a03e96bceadfcc5e18bd61e755980ee72dcdb15/modules/markup/markdown/markdown.go</a></li>
</ul>
<p>For this reason no implementation is available for the moment.</p>
</li>
<li><p class="first">Kramdown: It is unclear if this feature is available. See:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/gettalong/kramdown/search?q=anchor&amp;type=Issues&amp;utf8=%E2%9C%93">https://github.com/gettalong/kramdown/search?q=anchor&amp;type=Issues&amp;utf8=%E2%9C%93</a></li>
</ul>
</li>
</ul>
<div class="section" id="steps-to-add-an-unsupported-markdown-parser">
<h3>Steps to add an unsupported markdown parser<a class="headerlink" href="#steps-to-add-an-unsupported-markdown-parser" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Find the source code and/or documents.</li>
<li>Find the rules for each section, such as anchor link generation, title
detection, etc… Rely more on the source code than on the documentation (if
possible)</li>
<li>Add the relevant information on this page.</li>
<li>Write or adapt an algorithm for that section.</li>
<li>Write unit tests for it.</li>
<li>Add the new parser to the CLI interface.</li>
</ol>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">md-toc</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=frnmst&repo=md-toc&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Developer Interface</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Markdown spec</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-markdown-parsers">Supported markdown parsers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rules">Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-markdown-parsers">Other markdown parsers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="copyright_license.html">Copyright and License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="api.html" title="previous chapter">Developer Interface</a></li>
      <li>Next: <a href="contributing.html" title="next chapter">Contributing</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017-2020, Franco Masotti.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/markdown_specification.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/frnmst/md-toc" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>